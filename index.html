<!DOCTYPE html>
<html>
<head>
    <title>LOT/EXP QR Generator</title>
</head>
<body>
    <div class="container">
        <h2>LOT/EXP QR Generator</h2>
        <div class="form-group">
            <label for="upcBarcode">UPC Barcode (scan barcode, numeric and up to 12 digits):</label>
            <input type="text" id="upcBarcode">
            <span id="upcBarcodeError" style="color: red;"></span>
        </div>
        <div class="form-group">
            <label for="lotNumber">Lot Number (ALL CAPS ONLY):</label>
            <input type="text" id="lotNumber">
        </div>
        <div class="form-group">
            <label for="expirationDate">Expiration Date (YYMMDD):</label>
            <input type="date" id="expirationDate">
        </div>
        <button class="btn" onclick="generateQRCode()">Generate QR Code</button>
        <div class="qrcode-img"><div id="qrcode"></div><span id="qrcodeText"></span>
        </div>
    </div>

    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <script>
        var qrcode = null; 

        function generateQRCode() {
            var upcBarcode = document.getElementById("upcBarcode").value;
            var lotNumber = document.getElementById("lotNumber").value.toUpperCase();
            var expirationDate = document.getElementById("expirationDate").value;

            var upcBarcodeError = document.getElementById("upcBarcodeError");
            
            // Check if upcBarcode is empty or contains non-numeric characters
            if (upcBarcode.trim() === "" || !/^\d+$/.test(upcBarcode)) {
                upcBarcodeError.textContent = "UPC Barcode should contain only numeric characters.";
                return;
            }
            // Check if upcBarcode has more than 12 digits
            if (upcBarcode.length > 12) {
                upcBarcodeError.textContent = "UPC Barcode should not exceed 12 digits.";
                return;
            }
            // Clear any previous error messages
            upcBarcodeError.textContent = "";

            // Generate GS1 QR code with the input data
            var gs1QRCode = "0100" + upcBarcode +
                            "10" + lotNumber +
                            "~17" + expirationDate.replace(/-/g, '').slice(-6);

            // Removes existing QR code element when new QR is generated
            var qrcodeElement = document.getElementById("qrcode");
            while (qrcodeElement.firstChild) {
                qrcodeElement.removeChild(qrcodeElement.firstChild);
            }

            // Generate QR code using qrcode.js library
            qrcode = new QRCode(qrcodeElement, {
                text: gs1QRCode,
                width: 128,
                height: 128
            });

 
            var qrcodeText = document.getElementById("qrcodeText");
            qrcodeText.innerText = "UPC Barcode: " + upcBarcode + "\nLot Number: " + lotNumber + "\nExpiration Date: " + expirationDate.replace(/-/g, '').slice(-6);
        }
    </script>
</body>
</html>
